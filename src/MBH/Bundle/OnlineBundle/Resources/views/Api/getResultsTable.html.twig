{% spaceless %}

    {% if tariffResults|length > 0 %}
    <div id="mbh-results-global-wrapper">

    {% if results|length %}
        <div id="mbh-image-show-wrapper"></div>
        <div id="mbh-results-duration">
            <div id="mbh-result-response-info">
                <span id="mbh-results-duration-days">{{ results|first.days }}</span>
                <span id="mbh-results-duration-nights">{{ results|first.nights }}</span>
            </div>
            {{ 'views.api.getResultsTable.hotel_rooms_for'|trans({}, 'MBHOnlineBundle') }} {{ plural( results|first.nights, 'views.api.getResultsTable.noch'|trans({}, 'MBHOnlineBundle'),'views.api.getResultsTable.nochi'|trans({}, 'MBHOnlineBundle'), 'views.api.getResultsTable.nochei'|trans({}, 'MBHOnlineBundle')) }} c <span id="mbh-results-duration-begin">{{ results|first.begin|date('d.m.Y') }}</span> по <span id="mbh-results-duration-end">{{ results|first.end|date('d.m.Y') }}</span>
        </div>
        {% if tariffResults|length > 0 %}
            {% include 'MBHOnlineBundle:Api:tariffs.html.twig' with {'tariffResults': tariffResults} %}
        {% endif %}

       <div id="mbh-results-table-wrapper">
        <table id="mbh-results-table" class="table table-striped">
            <thead>
            <tr>
                <th id="mbh-results-table-th-roomType" style="width:50%;">{{ 'views.api.getResultsTable.room_type'|trans({}, 'MBHOnlineBundle') }}</th>
                <th id="mbh-results-table-th-tourist">{{ 'views.api.getResultsTable.guests'|trans({}, 'MBHOnlineBundle') }}</th>
                <th id="mbh-results-table-th-price">{{ 'views.api.getResultsTable.price'|trans({}, 'MBHOnlineBundle') }}</th>
                <th id="mbh-results-table-th-amount"></th>
            </tr>
            </thead>

            {% for result in results %}
                <tbody>
                <tr class="{{ cycle(['odd', 'even'], loop.index0) }}">
                    <td class="mbh-left">
                        <span class="mbh-results-tariff"
                              data-id="{{ result.tariff.id }}">{{ result.tariff.fullTitle }}</span>
                        {% if result.roomType.getMainImage is not empty %}
                        <a class="fancybox" title="{{ result.roomType }}" rel="group_{{ result.roomType.id }}" href="{{ asset(result.roomType.getMainImage.path, null, true) }}">
                            <img class="mbh-roomType-image" src="{{ asset(result.roomType.getMainImage.path, null, true) }}">
                        </a>
                        {% endif %}
                        <span class="mbh-results-roomType" data-id="{{ result.roomType.id }}">{{ result.roomType.fullTitle }}</span>
                        <div class="mbh-results-list-facilities">
                            {% for facility in result.roomType.facilities|slice(0, 7) %}
                                <i title="{{ facilities[facility] }}" class="mbf-{{ facility }} available"></i>
                            {% endfor %}
                        </div>
                        {% if hotels|length > 1 %}<span class="mbh-results-hotel" data-id="{{ result.roomType.hotel.id }}">{{ result.roomType.hotel.fullTitle }}</span>{% endif %}
                        {% if result.roomType.description is not empty or result.roomType.images is not empty %}
                            <div class="mbh-results-roomType-description-wrappper">
                                <a href="#" class="mbh-results-roomType-description-link"> <i
                                            class="fa fa-angle-right "> </i> {{ 'views.api.getResultsTable.room_description'|trans({}, 'MBHOnlineBundle') }}</a>
                            </div>
                        {% endif %}
                    </td>
                    <td class="mbh-center">
                        <select class="mbh-results-tourists-select select2 {% if result.prices|length == 1 %}hidden{% endif %}">
                            {% for priceTourists, price  in result.prices %}
                                {% set arr = priceTourists|split('_') %}
                                <option value="{{ priceTourists }}">
                                    {% if arr[0] %}{{ arr[0] }} вз.{% endif %}{% if arr[1] and arr[0] %}+{% endif %}{% if arr[1] %}{{ arr[1] }} рб.{% endif %}
                                </option>
                            {% endfor %}
                        </select>
                        {% if result.prices|length == 1 %}
                            {% for priceTourists, price  in result.prices %}
                                {% set arr = priceTourists|split('_') %}
                                {% if arr[0] %}{% for i in 1..arr[0] %}<i class="fa fa-male"></i>&nbsp;{% endfor %}{% endif %}
                                {% if arr[1] %}{% for k in 1..arr[1] %}<small><i class="fa fa-child"></i></small>&nbsp;{% endfor %}{% endif %}
                            {% endfor %}
                        {% endif %}
                    </td>
                    <td class="mbh-right">
                        {% for priceTourists, price  in result.prices %}
                            
                            <ul class="mbh-results-prices">
                                <li data-value="{{ price }}"
                                        class="{{ priceTourists }}">{{ price|number_format }} {{ currency().text }}
                            </ul>
                            
                        {% endfor %}


                    </td>
                    <td class="mbh-right" style="width:150px;">
                        <button class="btn btn-sm btn-primary booking-button"><i class="fa fa-check"></i> Выбрать</button>
                        <span class="hide">
                            <select class="mbh-results-packages-count select2" style="width: 120px">
                                {% if  result.roomsCount > config.packages_max %}
                                    {% set max = config.packages_max %}
                                {% else %}
                                    {% set max = result.roomsCount %}
                                {% endif %}
                                <option value="0" selected="selected">Нет {{ 'choice.room_number'|transchoice(0) }}</option>
                                {% for i in 1..max %}
                                    <option value="{{ i }}">{{ i }} {{ 'choice.room_number'|transchoice(i) }}</option>
                                {% endfor %}
                            </select>
                        </span>
                    </td>
                </tr>
                {% if result.roomType.description is not empty or result.roomType.images is not empty %}
                <tr class="mbh-left mbh-results-roomType-description-tr">
                    <td class="mbh-left mbh-results-roomType-description" colspan="5" >
                        <div class="room-type-photos">
                            {% for photo in result.roomType.images|slice(0, 10) %}
                                {% if not photo.isMain %}
                                    <a class="fancybox" title="{{ result.roomType }}" rel="group_{{ result.roomType.id }}" href="{{ photo.path|imagine_filter('zamkadom_thumb') }}"><img src="{{ photo.path|imagine_filter('zamkadom_thumb') }}" data-title="{{ result.roomType }}" alt="{{ result.roomType }}"></a>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <p>{{ result.roomType.description|raw }}</p>
                    </td>
                </tr>
                {% endif %}
                </tbody>
            {% endfor %}
        </table>
       </div>
                        
        <div id="mbh-results-actions">
                {#
                <span id="mbh-results-packages-total"> {{ 'views.api.getResultsTable.rooms'|trans({}, 'MBHOnlineBundle') }}<span id="mbh-results-total-packages-sum" class="mbh-results-total-sum">0</span>&nbsp;<span class="mbh-results-total-sum">{{ currency().text }}</span></span> &nbsp;
                <span id="mbh-results-services-total"> {{ 'views.api.getResultsTable.services'|trans({}, 'MBHOnlineBundle') }}<span id="mbh-results-total-services-sum" class="mbh-results-total-sum">0</span>&nbsp;<span class="mbh-results-total-sum">{{ currency().text }}</span></span> &nbsp;
                #}
                <span id="mbh-results-total">{{ 'views.api.getResultsTable.result'|trans({}, 'MBHOnlineBundle') }} <span id="mbh-results-total-sum" class="mbh-results-total-sum">0</span>&nbsp;<span class="mbh-results-total-sum">{{ currency().text }}</span></span>
            {% if userID %}
                <button id="mbh-results-next" class="btn btn-primary"> {{ 'views.api.getResultsTable.continue'|trans({}, 'MBHOnlineBundle') }}
                    <small><i class="fa fa-chevron-right "></i></small>
                </button>
            {% else %}
                <div class="alert alert-info">
                    <strong><a href="/enter.html">Войдите в систему</a>, чтобы произвести бронирование</strong>
                </div>
            {% endif %}
        </div>
    {% else %}
        {% if tariffResults|length > 0 %}
            {% include 'MBHOnlineBundle:Api:tariffs.html.twig' with {'tariffResults': tariffResults} %}
        {% endif %}
        <div class="mbh-results-error"><i class="fa fa-exclamation-circle"> </i> {{ 'views.api.getResultsTable.nothing_found_for_your_query'|trans({}, 'MBHOnlineBundle') }}
        </div>
    {% endif %}
            </div>
    {% endif %}
{% endspaceless %}

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.css" type="text/css" media="screen" />
<script>
    setTimeout(function() {$(".fancybox").fancybox({'openEffect': 'elastic'});}, 1000);

    $('.booking-button').each(function() {
        var $button = $(this);
        var $selectWrapper = $button.siblings('span');
        var $select = $selectWrapper.find('select');
        $button.on('click', function() {
            $button.hide();
            $selectWrapper.removeClass('hide');
            $select.val(1).trigger("change").trigger("click");
        });
        $select.on('change', function() {
            if($select.val() == 0) {
                $button.show();
                $selectWrapper.addClass('hide');
            };
        });
    })
</script>